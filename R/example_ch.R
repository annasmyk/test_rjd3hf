suppressPackageStartupMessages(library(rjd3highfreq))

# Bi-annual seasonality

s2 <- structure(c(469.204152273264, 472.1356798074, 470.231686255493, 
                  483.146161052509, 490.227597091944, 484.74825848541, 487.503785112587, 
                  474.52887188617, 458.626179769529, 446.900193750669, 461.321662682486, 
                  454.158066349904, 530.152280373854, 597.768775620842, 564.541613521487, 
                  521.248578290263, 488.417216740774, 496.176369256206, 507.548362175268, 
                  516.057255142671, 668.915656812781, 825.698731406419, 968.872880778632, 
                  761.884607641139, 567.803025862969, 555.517149760278, 566.495651909688, 
                  588.246689444436, 649.184999678456, 726.988221416075, 701.948795849455, 
                  689.185289695416, 681.931374995928, 693.24511894822, 719.38133184609, 
                  745.824128557345, 938.17756099776, 1127.97793471303, 1318.07302209996, 
                  1081.03756825206, 861.616165897904, 863.223433526174, 882.549128921091, 
                  880.65373685798, 1009.9491742249, 1085.31813582232, 1043.8210931877, 
                  978.337601059653, 937.056844080493, 946.470914551307, 963.479364651164, 
                  979.934959168939, 1210.57894146597, 1430.63523525091, 1653.32436800723, 
                  1375.11620418815, 1087.17669309632, 1113.04338250164, 1112.36417754144, 
                  1100.67746377289, 1178.13539075908, 1256.71790484714, 1179.856018912, 
                  1079.20112283432, 1022.34300834865, 1024.94289447601, 1022.66333858163, 
                  994.334523998076, 1266.74925426533, 1542.86474638389, 1791.9101658155, 
                  1382.77011170323, 996.751779567994, 1002.01677384741, 990.497130119013, 
                  979.795900742499, 1295.94321758486, 1619.54887005365, 1402.29684472329, 
                  1142.59756476717, 924.334693632299, 944.716523040673, 970.453145734395, 
                  986.248398065193, 1333.2535405725, 1681.81312950911, 2024.90382677556, 
                  1560.8375538191, 1119.0053543496, 1163.78280619748, 1218.72154584179, 
                  1232.60138767892, 1610.99536387937, 2020.18689698069, 1748.58912544328, 
                  1480.58816184383, 1213.10419793364, 1223.19786318543, 1227.01894252051, 
                  1216.00675333597, 1081.2731671739, 651.073841824608, 1128.35054692243, 
                  992.739965079948, 937.419235101413, 1435.25500300426), 
                .Tsp = c(1995,2021.25, 4), 
                class = "ts"
)

y<-log(s2)
step1<-rjd3highfreq::fractionalAirlineEstimation(y, periods=4, 
                                outliers=c("ao"), criticalValue = 3.5)

# linearized series (y-Xb)      
lin<-step1$model$linearized

# outliers effects (ao)
ao<-step1$model$X%*%t(step1$model$b)

step2<-rjd3highfreq::fractionalAirlineDecomposition(lin, period=4)

t<-ts(exp(step2$decomposition$t), frequency = frequency(y), start=start(y))
s<-ts(exp(step2$decomposition$s), frequency = frequency(y), start=start(y))
sa<-ts(exp(step2$decomposition$sa+ao), frequency = frequency(y), start=start(y))

ts.plot(ts.union(s2, t, sa), col=c("gray", "red", "blue"))
